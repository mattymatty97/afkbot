<html>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Ubuntu:regular,bold&subset=Latin">
    <head>
        <title>NOPE</title>
        <link rel="stylesheet" href="index.css">
    </head>
    <body>
        <table class="main_table">
            <tr>
                <td>
                    <div class="tab_list">
                        <h1>Tab list</h1>
                        <table class="tab_list_content">
                            <tr><td><a>Nothing to show</a></td></tr>
                        </table>
                    </div>
                </td>
                <td>
                    <table class="sub_table">
                        <tr><td>
                            <div class="content">
                                <h1>Connected as: <div class="uname">NOT CONNECTED</div> </h1>
                                Password (leave blank if none) : <input type="password" class="password"><br>
                                <button id="mainButton" class="start" onclick="start()">Connect</button><br><br>
                                <input type="checkbox" class="restart" onchange="toggleRestartQueue()"> Restart if disconnected?
                            </div>
                        </td></tr>
                        <tr><td style="padding-top: 15px">
                            <!-- Tab links -->
                            <div class="tab">
                                <button id="btnChat" class="tablinks" onclick="openTab('Chat')">Chat</button>
                                <button id="btnLog" class="tablinks" onclick="openTab('Log')">Log</button>
                                <button id="btnConsole" class="tablinks" onclick="openTab('Console')">Console</button>
                                <div style="padding: 10px; display: inline-block">
                                    <input type="checkbox" id="autoscroll" onchange="togglescroll()" checked=true><a> autoScroll?</a>
                                </div>
                            </div>

                        </td></tr>
                        <tr><td>
                            <!-- Tab content -->
                            <div id="Chat" class="tabcontent">
                                <div id="divchat" class="cycleView">
                                <table class="chat">
                                    <tr><td>Chat</td></tr>
                                </table>
                                </div><br>
                                <input type="text" class="chatInput">
                                <button id="sendChat" class="send" onclick="sendChat()"><b>Send</b></button>
                            </div>

                            <div id="Log" class="tabcontent">
                                <div class=" cycleView" id="divLog">
                                <table class="log cycleView">
                                    <tr><td>Log</td></tr>
                                </table>
                                </div>
                            </div>

                            <div id="Console" class="tabcontent">
                                <div id="divConsole" class="cycleView">
                                <table class="console">
                                    <tr><td>Console</td></tr>
                                </table>
                                </div><br>
                                <input type="text" class="consoleInput">
                                <button id="sendConsole" class="send" onclick="sendConsole()"><b>Send</b></button>
                            </div>
                            <script>

                                var autoscroll = true;
                                function updateScroll(){
                                    let element
                                    if(autoscroll === true){
                                        element = document.getElementById("divchat");
                                        element.scrollTop = element.scrollHeight;
                                        element = document.getElementById("divConsole");
                                        element.scrollTop = element.scrollHeight;
                                        element = document.getElementById("divLog");
                                        element.scrollTop = element.scrollHeight;
                                    }
                                }

                                function togglescroll() {
                                    autoscroll = document.getElementById("autoscroll").checked;
                                }

                                function openTab(tabName) {
                                    // Declare all variables
                                    var i, tabcontent, tablinks;

                                    // Get all elements with class="tabcontent" and hide them
                                    tabcontent = document.getElementsByClassName("tabcontent");
                                    for (i = 0; i < tabcontent.length; i++) {
                                        tabcontent[i].style.display = "none";
                                    }

                                    // Get all elements with class="tablinks" and remove the class "active"
                                    tablinks = document.getElementsByClassName("tablinks");
                                    for (i = 0; i < tablinks.length; i++) {
                                        tablinks[i].className = tablinks[i].className.replace(" active", "");
                                    }

                                    // Show the current tab, and add an "active" class to the button that opened the tab
                                    document.getElementById(tabName).style.display = "block";
                                    document.getElementById("btn"+tabName).className += " active";
                                }
                            </script>
                        </td></tr>

                        </td></tr>

                    </table>
                </td>
                <td>
                    <div class="scoreboard">
                        <h1>Scoreboard</h1>
                        <table class="scoreboard_content">
                            <tr><td><a>Nothing to show</a></td></tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
        <script>
            setInterval(() => { //each second, update the info.
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "/update", true);
                xhr.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        const response = JSON.parse(this.responseText);
                        document.getElementsByClassName("uname")[0].innerHTML = response.username;
                        document.getElementsByClassName("restart")[0].checked = response.restart;
                        document.getElementsByClassName("tab_list_content")[0].innerHTML = response.tablist;
                        document.getElementsByClassName("scoreboard_content")[0].innerHTML = response.scoreboard;
                        document.getElementsByClassName("chat")[0].innerHTML = response.chat;
                        document.getElementsByClassName("log")[0].innerHTML = response.log;
                        document.getElementsByClassName("console")[0].innerHTML = response.console;
                        updateScroll()
                        const mainButton = document.getElementById('mainButton');
                        if(response.connected){
                            mainButton.innerHTML = "Disconnect";
                            mainButton.setAttribute('onclick', 'stop()');
                            mainButton.className = 'stop';
                        }else{
                            mainButton.innerHTML = "Connect";
                            mainButton.setAttribute('onclick', 'start()');
                        mainButton.className = 'start';
                        }
                    }
                }
                xhr.setRequestHeader('XPassword', document.getElementsByClassName('password')[0].value)
                xhr.send();

            }, 1000);

            function start() {
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "/start", true);
                xhr.setRequestHeader('XPassword', document.getElementsByClassName('password')[0].value)
                xhr.send();
            }

            function stop() {
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "/stop", true);
                xhr.setRequestHeader('XPassword', document.getElementsByClassName('password')[0].value)
                xhr.send();
            }

            function toggleRestartQueue(){
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "/togglerestart", true);
                xhr.setRequestHeader('XPassword', document.getElementsByClassName('password')[0].value)
                xhr.send();
            }

            function sendChat() {
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "/send", true);
                xhr.setRequestHeader('XPassword', document.getElementsByClassName('password')[0].value)
                xhr.setRequestHeader('XChat', true)
                xhr.setRequestHeader('Xtext', document.getElementsByClassName('chatInput')[0].value)
                xhr.send();
                document.getElementsByClassName('chatInput')[0].value = ""
            }

            function sendConsole() {
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "/send", true);
                xhr.setRequestHeader('XPassword', document.getElementsByClassName('password')[0].value)
                xhr.setRequestHeader('XChat', false)
                xhr.setRequestHeader('Xtext', document.getElementsByClassName('consoleInput')[0].value)
                xhr.send();
                document.getElementsByClassName('consoleInput')[0].value = ""
            }

        </script>
    </body>
</html>